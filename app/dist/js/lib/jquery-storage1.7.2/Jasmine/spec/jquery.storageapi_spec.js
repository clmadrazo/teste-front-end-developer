function getWindowStorage(e){return testStorage(e)?window[e]:window[e.replace("Storage","CookieStorage")]}function testStorage(e){if(!window[e])return!1;var t="jsapi";try{return window[e].setItem(t,t),window[e].removeItem(t),!0}catch(n){return!1}}function clearAll(){wl.clear(),ws.clear();if($.cookie)for(var e in $.cookie())e!=""&&$.removeCookie(e)}wl=getWindowStorage("localStorage"),ws=getWindowStorage("sessionStorage"),clearAll(),describe("Jquery.StorageApi",function(){describe("Basics",function(){testStorage("localStorage")?it("Storage are natively avalaible",function(){expect(window.localStorage).toEqual(jasmine.any(Object)),expect(window.sessionStorage).toEqual(jasmine.any(Object))}):it("Storage are not natively avalaible but cookie fallback is enable",function(){expect(wl).toEqual(jasmine.any(Object)),expect(ws).toEqual(jasmine.any(Object))}),it("'createNamespace' create a new namespace in all storages",function(){var e=$.initNamespaceStorage("test_ns");expect($.namespaceStorages.test_ns).toEqual(e),expect(wl.getItem("test_ns")).toEqual("{}"),expect(ws.getItem("test_ns")).toEqual("{}"),$.cookie&&expect(window.cookieStorage.getItem("test_ns")).toEqual("{}")})});var e=["localStorage","sessionStorage"];$.cookie?e.push("cookieStorage"):console.log("Skipping $.cookieStorage specs. Could not load JQuery $.cookie."),e.push("ns.localStorage"),e.push("ns.sessionStorage"),$.cookie&&e.push("ns.cookieStorage");for(var t in e)describe(e[t],function(){if(e[t].indexOf("ns.")===0)var n=e[t].substr(3),r=$.initNamespaceStorage("test_ns")[n],i={getItem:function(e){var t=getWindowStorage(n).getItem("test_ns");return t=JSON.parse(t),t=t[e],typeof t=="object"?JSON.stringify(t):typeof t=="undefined"?null:t},setItem:function(e,t){var r=JSON.parse(getWindowStorage(n).getItem("test_ns"));try{t=JSON.parse(t)}catch(i){}r[e]=t,getWindowStorage(n).setItem("test_ns",JSON.stringify(r))}};else var n=!1,r=$[e[t]],i=getWindowStorage(e[t]);beforeEach(function(){n&&$.initNamespaceStorage("test_ns")}),afterEach(function(){clearAll()}),it("'removeAll' removes all items",function(){i.setItem("itemToDelete1","value1"),i.setItem("itemToDelete2","value2"),r.removeAll(),n&&$.initNamespaceStorage("test_ns"),expect(i.getItem("itemToDelete1")).toEqual(null),expect(i.getItem("itemToDelete2")).toEqual(null)}),it("'remove' removes one item (by name)",function(){i.setItem("itemToDelete","value"),i.setItem("itemToNotDelete","value"),r.remove("itemToDelete"),expect(i.getItem("itemToDelete")).toEqual(null),expect(i.getItem("itemToNotDelete")).toEqual("value")}),it("'remove' removes one item (by chain arguments)",function(){i.setItem("itemToDelete",JSON.stringify({item1:"value1",item2:"value2"})),i.setItem("itemToNotDelete","value"),r.remove("itemToDelete","item1"),expect(JSON.parse(i.getItem("itemToDelete"))).toEqual({item2:"value2"}),expect(i.getItem("itemToNotDelete")).toEqual("value")}),it("'remove' removes one item (by js syntax)",function(){i.setItem("itemToDelete",JSON.stringify({item1:"value1",item2:"value2"})),i.setItem("itemToNotDelete","value"),r.remove("itemToDelete.item1"),expect(JSON.parse(i.getItem("itemToDelete"))).toEqual({item2:"value2"}),expect(i.getItem("itemToNotDelete")).toEqual("value")}),it("'remove' removes multiple items (by name)",function(){i.setItem("itemToDelete1","value1"),i.setItem("itemToDelete2","value2"),i.setItem("itemToNotDelete","value"),r.remove(["itemToDelete1","itemToDelete2"]),expect(r.get("itemToDelete1")).toEqual(null),expect(r.get("itemToDelete2")).toEqual(null),expect(r.get("itemToNotDelete")).toEqual("value")}),it("'remove' removes multiple items (by chain arguments)",function(){i.setItem("itemToDelete",JSON.stringify({item1:"value1",item2:"value2",item3:"value3"})),i.setItem("itemToNotDelete","value"),r.remove("itemToDelete",["item1","item2"]),expect(JSON.parse(i.getItem("itemToDelete"))).toEqual({item3:"value3"}),expect(i.getItem("itemToNotDelete")).toEqual("value")}),it("'remove' removes multiple items (by js syntax)",function(){i.setItem("itemToDelete",JSON.stringify({prop1:{item1:"value1",item2:"value2",item3:"value3"}})),i.setItem("itemToNotDelete","value"),r.remove("itemToDelete.prop1",["item1","item2"]),expect(JSON.parse(i.getItem("itemToDelete")).prop1).toEqual({item3:"value3"}),expect(i.getItem("itemToNotDelete")).toEqual("value")}),it("'set' stores one item (by name)",function(){var e=r.set("item","value");expect(e).toEqual("value"),expect(i.getItem("item")).toEqual("value")}),it("'set' stores one item (by chain arguments)",function(){var e=r.set("item","itemprop","value");expect(e).toEqual({itemprop:"value"}),expect(JSON.parse(i.getItem("item"))).toEqual({itemprop:"value"})}),it("'set' stores one item (by js syntax)",function(){var e=r.set("item.itemprop","value");expect(e).toEqual({itemprop:"value"}),expect(JSON.parse(i.getItem("item"))).toEqual({itemprop:"value"})}),it("'set' stores multiple items (by name)",function(){var e=r.set({item1:"value1",item2:"value2"});expect(e).toEqual({item1:"value1",item2:"value2"}),expect(i.getItem("item1")).toEqual("value1"),expect(i.getItem("item2")).toEqual("value2")}),it("'set' stores multiple items (by chain arguments)",function(){var e=r.set("item","prop1",{item1:"value1",item2:"value2"});expect(e).toEqual({prop1:{item1:"value1",item2:"value2"}}),expect(JSON.parse(i.getItem("item")).prop1.item1).toEqual("value1"),expect(JSON.parse(i.getItem("item")).prop1.item2).toEqual("value2")}),it("'set' stores multiple items (by js syntax)",function(){var e=r.set("item.prop1",{item1:"value1",item2:"value2"});expect(e).toEqual({prop1:{item1:"value1",item2:"value2"}}),expect(JSON.parse(i.getItem("item")).prop1.item1).toEqual("value1"),expect(JSON.parse(i.getItem("item")).prop1.item2).toEqual("value2")}),it("'get' retrieves one item (by name)",function(){r.set("item","value"),expect(r.get("item")).toEqual("value")}),it("'get' retrieves one item (by chain arguments)",function(){r.set("item","itemprop","value"),expect(r.get("item","itemprop")).toEqual("value")}),it("'get' retrieves one item (by js syntax)",function(){r.set("item","itemprop","value"),expect(r.get("item.itemprop")).toEqual("value")}),it("'get' retrieves multiple items (by name)",function(){r.set("item1","value1"),r.set("item2","value2"),r.set("item3","value3"),expect(r.get(["item1","item3"])).toEqual({item1:"value1",item3:"value3"})}),it("'get' retrieves multiple items (by chain arguments)",function(){r.set("item",{itemprop1:"value1",itemprop2:"value2",itemprop3:"value3"}),expect(r.get("item",["itemprop1","itemprop3"])).toEqual({itemprop1:"value1",itemprop3:"value3"})}),it("'get' retrieves multiple items (by js syntax)",function(){r.set("item","item1",{item1prop1:"value1",item1prop2:"value2",item1prop3:"value3"}),expect(r.get("item.item1",["item1prop1","item1prop3"])).toEqual({item1prop1:"value1",item1prop3:"value3"})}),it("'keys' returns the keys associated with a storage",function(){r.set("item1","value1"),r.set("item2","value2"),expect(r.keys()).toEqual(["item1","item2"])}),it("'keys' returns the keys associated with an item in a storage (by name)",function(){r.set("item",{item1:"value1",item2:"value2"}),expect(r.keys("item")).toEqual(["item1","item2"])}),it("'keys' returns the keys associated with an item in a storage (by chain arguments)",function(){r.set("item","itemprop",{item1:"value1",item2:"value2"}),expect(r.keys("item","itemprop")).toEqual(["item1","item2"])}),it("'keys' returns the keys associated with an item in a storage (by js syntax)",function(){r.set("item.itemprop",{item1:"value1",item2:"value2"}),expect(r.keys("item","itemprop")).toEqual(["item1","item2"])}),it("'isEmpty' returns true if there is no items in storage",function(){expect(r.isEmpty()).toBeTruthy(),r.set("item","value"),expect(r.isEmpty()).toBeFalsy()}),it("'isEmpty' returns true if item in storage is empty (by name)",function(){r.set("item1","value"),r.set("item2",""),r.set("item3",[]),r.set("item4",[1]),r.set("item5",{}),r.set("item6",{prop:"value"}),expect(r.isEmpty("item1")).toBeFalsy(),expect(r.isEmpty("item2")).toBeTruthy(),expect(r.isEmpty("item3")).toBeTruthy(),expect(r.isEmpty("item4")).toBeFalsy(),expect(r.isEmpty("item5")).toBeTruthy(),expect(r.isEmpty("item6")).toBeFalsy()}),it("'isEmpty' returns true if item in storage is empty (by chain arguments)",function(){r.set("item","prop1","value1"),expect(r.isEmpty("item","prop1")).toBeFalsy(),expect(r.isEmpty("item","prop2")).toBeTruthy()}),it("'isEmpty' returns true if item in storage is empty (by js syntax)",function(){r.set("item","prop1","value1"),expect(r.isEmpty("item.prop1")).toBeFalsy(),expect(r.isEmpty("item.prop2")).toBeTruthy()}),it("'isEmpty' returns true if multiple items in storage are empty (by name)",function(){r.set({item1:"value1",item2:"value2",item3:"",item4:""}),expect(r.isEmpty(["item1","item2"])).toBeFalsy(),expect(r.isEmpty(["item3","item4"])).toBeTruthy(),expect(r.isEmpty(["item1","item3"])).toBeFalsy()}),it("'isEmpty' returns true if multiple items in storage are empty (by chain arguments)",function(){r.set("item1","prop1",{item1:"value1",item2:"value2",item3:"",item4:""}),expect(r.isEmpty("item1","prop1",["item1","item2"])).toBeFalsy(),expect(r.isEmpty("item1","prop1",["item3","item4"])).toBeTruthy(),expect(r.isEmpty("item1","prop1",["item1","item3"])).toBeFalsy()}),it("'isEmpty' returns true if multiple items in storage are empty (by js syntax)",function(){r.set("item1","prop1",{item1:"value1",item2:"value2",item3:"",item4:""}),expect(r.isEmpty("item1.prop1",["item1","item2"])).toBeFalsy(),expect(r.isEmpty("item1.prop1",["item3","item4"])).toBeTruthy(),expect(r.isEmpty("item1.prop1",["item1","item3"])).toBeFalsy()}),it("'isSet' returns true if item in storage exists (by name)",function(){r.set("item1","value"),r.set("item2",null),r.set("item3",""),expect(r.isSet("item1")).toBeTruthy(),expect(r.isSet("item2")).toBeFalsy(),expect(r.isSet("item3")).toBeTruthy(),expect(r.isSet("item4")).toBeFalsy()}),it("'isSet' returns true if item in storage exists (by chain arguments)",function(){r.set("item","prop1","value1"),expect(r.isSet("item","prop1")).toBeTruthy(),expect(r.isSet("item","prop2")).toBeFalsy()}),it("'isSet' returns true if item in storage exists (by js syntax)",function(){r.set("item","prop1","value1"),expect(r.isSet("item.prop1")).toBeTruthy(),expect(r.isSet("item.prop2")).toBeFalsy()}),it("'isSet' returns true if multiple items in storage exist (by name)",function(){r.set({item1:"value1",item2:"value2",item3:"",item4:null}),expect(r.isSet(["item1","item2"])).toBeTruthy(),expect(r.isSet(["item1","item3"])).toBeTruthy(),expect(r.isSet(["item1","item4"])).toBeFalsy()}),it("'isSet' returns true if multiple items in storage exist (by chain arguments)",function(){r.set("item1","prop1",{item1:"value1",item2:"value2",item3:"",item4:null}),expect(r.isSet("item1","prop1",["item1","item2"])).toBeTruthy(),expect(r.isSet("item1","prop1",["item1","item3"])).toBeTruthy(),expect(r.isSet("item1","prop1",["item1","item4"])).toBeFalsy()}),it("'isSet' returns true if multiple items in storage exist (by js syntax)",function(){r.set("item1","prop1",{item1:"value1",item2:"value2",item3:"",item4:null}),expect(r.isSet("item1.prop1",["item1","item2"])).toBeTruthy(),expect(r.isSet("item1.prop1",["item1","item3"])).toBeTruthy(),expect(r.isSet("item1.prop1",["item1","item4"])).toBeFalsy()})});describe("Specific cases",function(){clearAll(),it("'removeAll' reinitialize namespace if true is given in arguments",function(){$.localStorage.set("item","value"),$.sessionStorage.set("item","value");var e=$.initNamespaceStorage("test_ns");e.localStorage.set("item","value"),e.sessionStorage.set("item","value"),$.localStorage.removeAll(!0),expect($.localStorage.get("item")).toEqual(null),expect($.sessionStorage.get("item")).toEqual("value"),expect(e.localStorage.get("item")).toEqual(null),expect(e.sessionStorage.get("item")).toEqual("value")}),it("'$.removeAllStorages' remove all items in all storages",function(){$.localStorage.set("item","value"),$.sessionStorage.set("item","value");var e=$.initNamespaceStorage("test_ns");$.removeAllStorages(),expect($.localStorage.get("item")).toEqual(null),expect($.sessionStorage.get("item")).toEqual(null),expect($.localStorage.get("test_ns")).toEqual(null),expect($.sessionStorage.get("test_ns")).toEqual(null),$.cookie&&(expect($.cookieStorage.get("item")).toEqual(null),expect($.cookieStorage.get("test_ns")).toEqual(null)),expect($.namespaceStorages).toEqual({})}),it("'$.removeAllStorages' remove all items in all storages and reinitialize namespace if true is given in arguments",function(){$.localStorage.set("item","value"),$.sessionStorage.set("item","value");var e=$.initNamespaceStorage("test_ns");$.removeAllStorages(!0),expect($.localStorage.get("item")).toEqual(null),expect($.sessionStorage.get("item")).toEqual(null),expect($.localStorage.get("test_ns")).toEqual({}),expect($.sessionStorage.get("test_ns")).toEqual({}),$.cookie&&(expect($.cookieStorage.get("item")).toEqual(null),expect($.cookieStorage.get("test_ns")).toEqual({})),expect($.namespaceStorages.test_ns).toEqual(e)})})});