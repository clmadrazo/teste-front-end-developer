/*!
 * MockJax - jQuery Plugin to Mock Ajax requests
 *
 * Version:  1.4.0
 * Released: 2011-02-04
 * Source:   http://github.com/appendto/jquery-mockjax
 * Docs:     http://enterprisejquery.com/2010/07/mock-your-ajax-requests-with-mockjax-for-rapid-development
 * Plugin:   mockjax
 * Author:   Jonathan Sharp (http://jdsharp.com)
 * License:  MIT,GPL
 * 
 * Copyright (c) 2010 appendTo LLC.
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 */

(function(e){function r(t){window["DOMParser"]==undefined&&window.ActiveXObject&&(DOMParser=function(){},DOMParser.prototype.parseFromString=function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t});try{var n=(new DOMParser).parseFromString(t,"text/xml");if(!e.isXMLDoc(n))throw"Unable to parse XML";var r=e("parsererror",n);if(r.length==1)throw"Error: "+e(n).text()}catch(i){var s=i.name==undefined?i:i.name+": "+i.message;return e(document).trigger("xmlParseError",[s]),undefined}return n}var t=e.ajax,n=[];e.extend({ajax:function(i){var s=jQuery.extend(!0,{},jQuery.ajaxSettings,i),o=!1;return e.each(n,function(u,a){if(!n[u])return;var f=null;if(e.isFunction(n[u]))f=n[u](s);else{f=n[u];if(e.isFunction(f.url.test))f.url.test(s.url)||(f=null);else{var l=f.url.indexOf("*");if(f.url!="*"&&f.url!=s.url&&l==-1||l>-1&&f.url.substr(0,l)!=s.url.substr(0,l))f=null}if(f){if(f.data&&s.data){var c=!1;(function S(t,n){if(typeof n=="string")return c=e.isFunction(t.test)?t.test(n):t==n,c;e.each(t,function(r,i){return n[r]===undefined?(c=!1,!1):(c=!0,typeof n[r]=="object"?S(t[r],n[r]):(e.isFunction(t[r].test)?c=t[r].test(n[r]):c=t[r]==n[r],c))})})(f.data,s.data),c==0&&(f=null)}f&&f.type&&f.type!=s.type&&(f=null)}}if(f){o=!0;var h=e.extend({},e.mockjaxSettings,f);h.log&&e.isFunction(h.log)&&h.log("MOCK "+s.type.toUpperCase()+": "+s.url,e.extend({},s));var p=/=\?(&|$)/,d=(new Date).getTime();if(s.dataType==="jsonp"){if(s.type.toUpperCase()==="GET")p.test(s.url)||(s.url+=(rquery.test(s.url)?"&":"?")+(s.jsonp||"callback")+"=?");else if(!s.data||!p.test(s.data))s.data=(s.data?s.data+"&":"")+(s.jsonp||"callback")+"=?";s.dataType="json"}s.dataType==="json"&&(s.data&&p.test(s.data)||p.test(s.url))&&(jsonp=s.jsonpCallback||"jsonp"+d++,s.data&&(s.data=(s.data+"").replace(p,"="+jsonp+"$1")),s.url=s.url.replace(p,"="+jsonp+"$1"),s.dataType="script",window[jsonp]=window[jsonp]||function(e){data=e,b(),w(),window[jsonp]=undefined;try{delete window[jsonp]}catch(t){}head&&head.removeChild(script)});var v=/^(\w+:)?\/\/([^\/?#]+)/,m=v.exec(s.url),g=m&&(m[1]&&m[1]!==location.protocol||m[2]!==location.host);if(s.dataType==="script"&&s.type.toUpperCase()==="GET"&&g){var y=i&&i.context||s;function b(){s.success&&s.success.call(y,f.response?f.response.toString():f.responseText||"",status,{}),s.global&&E("ajaxSuccess",[{},s])}function w(){s.complete&&s.complete.call(y,{},status),s.global&&E("ajaxComplete",[{},s]),s.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop")}function E(e,t){(s.context?jQuery(s.context):jQuery.event).trigger(e,t)}return f.response&&e.isFunction(f.response)?f.response(i):e.globalEval(f.responseText),b(),w(),!1}return o=t.call(e,e.extend(!0,{},i,{xhr:function(){return f=e.extend({},e.mockjaxSettings,f),f.contentType&&(f.headers["content-type"]=f.contentType),{status:f.status,readyState:1,open:function(){},send:function(){var n=function(t){return function(){return function(){this.status=f.status,this.readyState=4,e.isFunction(f.response)&&f.response(i),s.dataType=="json"&&typeof f.responseText=="object"?this.responseText=JSON.stringify(f.responseText):s.dataType=="xml"?typeof f.responseXML=="string"?this.responseXML=r(f.responseXML):this.responseXML=f.responseXML:this.responseText=f.responseText,e.isFunction(this.onreadystatechange)&&this.onreadystatechange(f.isTimeout?"timeout":undefined)}.apply(t)}}(this);f.proxy?t({global:!1,url:f.proxy,type:f.proxyType,data:f.data,dataType:s.dataType,complete:function(e,t){f.responseXML=e.responseXML,f.responseText=e.responseText,this.responseTimer=setTimeout(n,f.responseTime||0)}}):s.async===!1?n():this.responseTimer=setTimeout(n,f.responseTime||50)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(){},getResponseHeader:function(e){if(f.headers&&f.headers[e])return f.headers[e];if(e.toLowerCase()=="last-modified")return f.lastModified||(new Date).toString();if(e.toLowerCase()=="etag")return f.etag||"";if(e.toLowerCase()=="content-type")return f.contentType||"text/plain"},getAllResponseHeaders:function(){var t="";return e.each(f.headers,function(e,n){t+=e+": "+n+"\n"}),t}}}})),!1}}),o?o:t.apply(e,arguments)}}),e.mockjaxSettings={log:function(e){window.console&&window.console.log&&window.console.log(e)},status:200,responseTime:500,isTimeout:!1,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}},e.mockjax=function(e){var t=n.length;return n[t]=e,t},e.mockjaxClear=function(e){arguments.length==1?n[e]=null:n=[]}})(jQuery);